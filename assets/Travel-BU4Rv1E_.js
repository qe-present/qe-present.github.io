import{b as fe}from"./QScrollObserver-BZMWZn3e.js";import{T as ae,G as ne}from"./GetMap-eJm4tlm0.js";import{S as pe,g as ee,Q as ye,a as Le}from"./SelectDialog-CcbJFqqY.js";import{a0 as ce,_ as q,r as f,N as V,a8 as Q,s as m,t as k,u as c,v as s,Q as F,F as j,a1 as X,a9 as Se,L as Z,D as O,G as B,J as $,P as he,I as J,a as te,a4 as K,H as le,z as oe,a5 as se,x as U,R as ie,a2 as _e,a3 as ve}from"./index-BA2WbrAd.js";import{Q as T,a as A}from"./QItem-DqCSo7du.js";import{u as x}from"./use-quasar-DnxGdjeW.js";import{Q as ke,b as de,m as ue}from"./query-BqSoigVF.js";import{u as ge}from"./setting-store-BLOsk0CX.js";import"./TouchPan-BTz0YLpl.js";import"./selection-CFiBBX0U.js";import"./ClosePopup-CuUEWXBu.js";import"./QSelect-CJUPlzAD.js";import"./QItemLabel-DcYHGSRO.js";import"./position-engine-CuOnOx01.js";const E=ce("travel",{state:()=>({markerLayer:null,map:null,endLayer:null,startLayer:null,startSure:null,endSure:null,startName:null,endName:null,anotherLayer:null}),getters:{getMap(){return this.map},getAnotherLayer(){return this.anotherLayer},getStartName(){return this.startName},getEndName(){return this.endName}},actions:{reset(){this.markerLayer&&(this.markerLayer.clearLayers(),console.log(this.markerLayer)),this.startLayer&&this.startLayer.clearLayers(),this.endLayer&&this.endLayer.clearLayers(),this.anotherLayer&&this.anotherLayer.clearLayers(),this.markerLayer=null,this.startSure=!1,this.endSure=!1,this.startLayer=null,this.endLayer=null,this.startName=null,this.endName=null,this.anotherLayer=null},setStartSure(a){this.startSure=a},setEndSure(a){this.endSure=a},getStartSure(){return this.startSure},getEndSure(){return this.endSure},setMap(a){this.map=a},getMarkerLayer(){return this.markerLayer},setMarkerLayer(a){this.markerLayer=a},setEndLayer(a){this.endLayer=a},getEndLayer(){return this.endLayer},setStartLayer(a){this.startLayer=a},getStartLayer(){return this.startLayer},setStartName(a){this.startName=a},setEndName(a){this.endName=a}}}),M=ce("other",{state:()=>({nodeLayer:null,lineLayer:null,walkLayer:null,pointToLayer:[],nodes:[]}),getters:{getPointToLayer(a){return a.pointToLayer},getLineLayer(a){return a.lineLayer},getWalkLayer(a){return a.walkLayer},getNodeLayer(a){return a.nodeLayer},getNodes(a){return a.nodes}},setters:{setPointToLayer(a,t){a.pointToLayer=t},setLineLayer(a,t){a.lineLayer=t},setWalkLayer(a,t){a.walkLayer=t},setNodeLayer(a,t){a.nodeLayer=t},setNodes(a,t){a.nodes=t}},actions:{reset(a){this.lineLayer&&a.removeLayer(this.lineLayer),this.walkLayer&&a.removeLayer(this.walkLayer),this.pointToLayer.length>0&&this.pointToLayer.forEach(t=>{a.removeLayer(t)}),this.nodes=[]}}}),be={__name:"Search",setup(a,{expose:t}){t();const o=M(),e=x(),u=E();let n=null,r,g,y=[],h=[],d=f([]);const P=()=>{if(r=u.getStartLayer(),r.getLayers().length===1)return y.push(r.getLayers()[0]),!0},v=()=>{if(g=u.getEndLayer(),g.getLayers().length===1)return h.push(g.getLayers()[0]),!0},S=()=>{if(!P()){e.notify({type:"negative",message:"请选择起点",position:"top-right"});return}if(!v()){e.notify({type:"negative",message:"请选择终点",position:"top-right"});return}let i=X(y.pop()),b=X(h.pop());o.nodeLayer.getLayers().forEach(w=>{let l=w.getLatLng();d.value.push(L.point(l.lng,l.lat))}),Object.keys(i._layers).forEach(w=>{let l=i._layers[w]._latlng;d.value.unshift(L.point(l.lng,l.lat))}),Object.keys(b._layers).forEach(w=>{let l=b._layers[w]._latlng;d.value.push(L.point(l.lng,l.lat))}),o.lineLayer&&n.removeLayer(o.lineLayer),o.walkLayer&&n.removeLayer(o.walkLayer),o.pointToLayer.length>0&&o.pointToLayer.forEach(w=>{n.removeLayer(w)}),C()};function C(){n=u.map;let i=new L.supermap.NetworkAnalystService(ae),b=new L.supermap.TransportationAnalystResultSetting({returnEdgeFeatures:!0,returnEdgeGeometry:!0,returnEdgeIDs:!0,returnNodeFeatures:!0,returnNodeGeometry:!0,returnNodeIDs:!0,returnPathGuides:!0,returnRoutes:!0}),I=new L.supermap.TransportationAnalystParameter({resultSetting:b,weightFieldName:"time"}),R=new L.supermap.FindPathParameters({isAnalyzeById:!1,nodes:d.value,parameter:I});d.value=[];let w=L.icon({iconUrl:"walk.png",iconSize:[20,20]});i.findPath(R,function(l){l.result.pathList.map(function(_){let z=L.geoJSON(_.route).addTo(n);o.lineLayer=z;let re=L.geoJSON(_.pathGuideItems,{pointToLayer:function(W,Y){let p=L.marker(Y,{icon:w}).addTo(n);o.pointToLayer.push(p)},filter:function(W){return!!(W.geometry&&W.geometry.type==="Point")}}).addTo(n);o.walkLayer=re})})}const N={otherStore:o,$q:e,travelStore:u,get map(){return n},set map(i){n=i},get startLayer(){return r},set startLayer(i){r=i},get endLayer(){return g},set endLayer(i){g=i},get startList(){return y},set startList(i){y=i},get endList(){return h},set endList(i){h=i},get nodes(){return d},set nodes(i){d=i},hasStartLayer:P,hasEndLayer:v,handleSearch:S,findPathProcess:C,get useTravelStore(){return E},get useQuasar(){return x},ref:f,toRaw:X,get TRANSPORTATION_ANALYST_URL(){return ae},get useOtherStore(){return M}};return Object.defineProperty(N,"__isScriptSetup",{enumerable:!1,value:!0}),N}};function we(a,t,o,e,u,n){return V((m(),k(A,{clickable:""},{default:c(()=>[s(T,{avatar:"",class:"text-purple q-gutter-md"},{default:c(()=>[s(F,{name:"mdi-map-marker-radius"})]),_:1}),s(T,null,{default:c(()=>[s(j,{color:"primary",icon:"search",label:"搜寻路线",onClick:e.handleSearch})]),_:1})]),_:1})),[[Q]])}const Te=q(be,[["render",we],["__file","Search.vue"]]),Ee={__name:"TravelTable",props:Se({need:{type:String,default:"start"}},{dialog:{},dialogModifiers:{},tableData:{},tableDataModifiers:{},flag:{},flagModifiers:{}}),emits:["update:dialog","update:tableData","update:flag"],setup(a,{expose:t}){t();const o=x(),e=E(),u=f("bottom"),n=e.map;let r=e.getMarkerLayer();const g=Z(a,"dialog"),y=Z(a,"tableData"),h=Z(a,"flag"),d=f([]),P=f(!1),v=a;let S;const C=[{name:"id",required:!0,label:"车站号",align:"center",field:"id",sortable:!0},{name:"name",label:"地名",field:"name"},{name:"markerID",label:"标记id",field:"markerId",sortable:!0},{name:"lat",align:"center",label:"纬度",field:l=>l.position.x},{name:"lng",label:"经度",field:l=>l.position.y}];let N=y.value,i;O(()=>{N=y.value}),O(()=>{h.value&&!g.value&&o.notify({type:"info",message:"请先选择一个站点",position:"top",timeout:1e3})});const b=(l,D=15)=>{r=e.getMarkerLayer();let _=r.getLayer(l);if(_){let z=_.getLatLng();n.flyTo(z,D)}},w={$q:o,travelStore:e,bottom:u,map:n,get markers(){return r},set markers(l){r=l},dialog:g,tableData:y,flag:h,selected:d,secondDialog:P,props:v,get content(){return S},set content(l){S=l},columns:C,get rows(){return N},set rows(l){N=l},get selectedMarkerId(){return i},set selectedMarkerId(l){i=l},flyToSelected:b,handleSelect:l=>{i=l.keys[0],b(i)},handleChoose:()=>{d.value.length>0?(r.eachLayer(function(l){if(l._leaflet_id===i){let D=L.geoJSON(l.toGeoJSON(),{...l.options,icon:L.icon({iconUrl:`marker/${v.need}.png`,iconSize:[40,40]}),markersInheritOptions:!0});if(v.need==="Start"){S="起点站: "+l._popup._content+"<br><a href='https://baike.baidu.com/item/"+l._popup._content+"' target='_blank'>查看详情</a>",D.bindPopup(S);let _=e.getStartLayer();_.getLayers().length>0&&_.removeLayer(_.getLayers()[0]),_.addLayer(D),e.setStartSure(!0),e.setStartName(l._popup._content)}else if(v.need==="End"){S="终点站:"+l._popup._content+"<br><a href='https://baike.baidu.com/item/"+l._popup._content+"' target='_blank'>查看详情</a>",D.bindPopup(S);let _=e.getEndLayer();_.getLayers().length>0&&_.removeLayer(_.getLayers()[0]),_.addLayer(D),e.setEndSure(!0),e.setEndName(l._popup._content)}b(i,3),r.removeLayer(l)}else r.removeLayer(l)}),h.value=!1):P.value=!0},ref:f,watchEffect:O,toRaw:X,get useQuasar(){return x},get useTravelStore(){return E},SelectDialog:pe};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}},Pe={class:"q-pa-md"};function Ne(a,t,o,e,u,n){return m(),B(J,null,[s(he,{modelValue:e.dialog,"onUpdate:modelValue":t[1]||(t[1]=r=>e.dialog=r),position:e.bottom,"full-width":""},{default:c(()=>[$("div",Pe,[s(ke,{title:"查询结果如下, 请选择一个站点",rows:e.rows,columns:e.columns,"row-key":"markerId",selection:"single",selected:e.selected,"onUpdate:selected":t[0]||(t[0]=r=>e.selected=r),onSelection:e.handleSelect},{"top-right":c(()=>[s(j,{color:"primary",label:"确定",onClick:e.handleChoose})]),_:1},8,["rows","selected"])])]),_:1},8,["modelValue","position"]),s(e.SelectDialog,{modelValue:e.secondDialog,"onUpdate:modelValue":t[2]||(t[2]=r=>e.secondDialog=r)},null,8,["modelValue"])],64)}const Ce=q(Ee,[["render",Ne],["__file","TravelTable.vue"]]),De={__name:"TravelChooseForm",props:{startPlaceHolder:{type:String,default:"请输入起点"},endPlaceHolder:{type:String,default:"请输入终点"}},setup(a,{expose:t}){t();const o=f(de),e=x(),u=E(),n=f(""),r=f(),g=f(),y=f(""),h=f(!1),d=f(!1),P=f([]),v=f(!1),S=f(!1);let C=[],N=[],i="",b=!1,I=!1;O(()=>{n.value,b=!0}),O(()=>{y.value,I=!0});const R=p=>{u.map;let H=u.getMarkerLayer();H.clearLayers(),p.forEach(G=>{const me=L.marker([G.position.y,G.position.x],{stopID:G.stopID,name:G.name}).bindPopup(G.name).addTo(H);G.markerId=me._leaflet_id}),P.value=p},w=async()=>{if(u.setStartSure(!1),!n.value.trim()){i="请输入起始点",e.notify({type:"negative",message:i,position:"top",timeout:1e3});return}b&&(C=await ee(n.value),b=!1),C.length>=1?(v.value=!0,R(C),h.value=!0):C.length===0&&e.notify({type:"negative",message:"未找到相关的位置",position:"top",timeout:1e3})},l=async()=>{if(u.setEndSure(!1),!y.value.trim()){i="请输入终点",e.notify({type:"negative",message:i,position:"top",timeout:1e3});return}I&&(N=await ee(y.value),I=!1),N.length>=1?(S.value=!0,R(N),d.value=!0):N.length===0&&e.notify({type:"negative",message:"未找到相关的位置",position:"top",timeout:1e3})},D=p=>o.value.filter(H=>ue(H,p.value)&&H.toLowerCase()!==p.value.toLowerCase()),_=te(()=>D(n)),z=te(()=>D(y)),Y={allSuggestions:o,$q:e,travelStore:u,start:n,startSuggestions:r,endSuggestions:g,end:y,showStart:h,showEnd:d,tableData:P,flagStart:v,flagEnd:S,get startResult(){return C},set startResult(p){C=p},get endResult(){return N},set endResult(p){N=p},get messgae(){return i},set messgae(p){i=p},get startSend(){return b},set startSend(p){b=p},get endSend(){return I},set endSend(p){I=p},addPositionToMap:R,getStartInfo:w,getEndInfo:l,getSuggestions:D,filteredStartSuggestions:_,filteredEndSuggestions:z,selectStartSuggestion:p=>{n.value=p,r.value=!1},selectEndSuggestion:p=>{y.value=p,g.value=!1},computed:te,ref:f,watchEffect:O,get getStationInfo(){return ee},get useTravelStore(){return E},get match(){return ue},get useQuasar(){return x},TravelTable:Ce,get busPoint(){return de}};return Object.defineProperty(Y,"__isScriptSetup",{enumerable:!1,value:!0}),Y}},Ie={class:"suggestions-list"},Ve=["onClick"],Oe={class:"suggestions-list"},xe=["onClick"];function Me(a,t,o,e,u,n){return m(),B(J,null,[V((m(),k(A,{clickable:""},{default:c(()=>[s(T,{avatar:"",class:"text-purple q-gutter-md"},{default:c(()=>[s(F,{name:"mdi-hand-pointing-right"})]),_:1}),s(T,null,{default:c(()=>[e.travelStore.getStartSure()?U("",!0):(m(),k(K,{key:0,modelValue:e.start,"onUpdate:modelValue":t[0]||(t[0]=r=>e.start=r),placeholder:o.startPlaceHolder,onFocus:t[1]||(t[1]=r=>e.startSuggestions=!0),onBlur:t[2]||(t[2]=r=>e.startSuggestions=!1)},{default:c(()=>[V($("ul",Ie,[(m(!0),B(J,null,le(e.filteredStartSuggestions,(r,g)=>(m(),B("li",{key:`start-${g}`,onClick:y=>e.selectStartSuggestion(r),class:"suggestion-item"},oe(r),9,Ve))),128))],512),[[se,e.filteredStartSuggestions.length>0&&e.startSuggestions]])]),_:1},8,["modelValue","placeholder"])),e.travelStore.getStartSure()?(m(),k(K,{key:1,type:"text",disable:!0,modelValue:e.travelStore.getStartName,"onUpdate:modelValue":t[3]||(t[3]=r=>e.travelStore.getStartName=r)},null,8,["modelValue"])):U("",!0)]),_:1})]),_:1})),[[Q]]),V((m(),k(A,{clickable:""},{default:c(()=>[s(T,{avatar:"",class:"text-purple q-gutter-md"},{default:c(()=>[s(F,{name:"fa-solid fa-house"})]),_:1}),s(T,null,{default:c(()=>[s(j,{color:"primary",label:"出发点定位",onClick:e.getStartInfo})]),_:1})]),_:1})),[[Q]]),V((m(),k(A,{clickable:""},{default:c(()=>[s(T,{avatar:"",class:"text-purple q-gutter-md"},{default:c(()=>[s(F,{name:"mdi-arrow-right-bold-circle-outline"})]),_:1}),s(T,null,{default:c(()=>[e.travelStore.getEndSure()?U("",!0):(m(),k(K,{key:0,modelValue:e.end,"onUpdate:modelValue":t[4]||(t[4]=r=>e.end=r),placeholder:o.endPlaceHolder,onFocus:t[5]||(t[5]=r=>e.endSuggestions=!0),onBlur:t[6]||(t[6]=r=>e.endSuggestions=!1)},{default:c(()=>[V($("ul",Oe,[(m(!0),B(J,null,le(e.filteredEndSuggestions,(r,g)=>(m(),B("li",{key:`end-${g}`,onClick:y=>e.selectEndSuggestion(r),class:"suggestion-item"},oe(r),9,xe))),128))],512),[[se,e.filteredEndSuggestions.length>0&&e.endSuggestions]])]),_:1},8,["modelValue","placeholder"])),e.travelStore.getEndSure()?(m(),k(K,{key:1,type:"text",disable:!0,modelValue:e.travelStore.getEndName,"onUpdate:modelValue":t[7]||(t[7]=r=>e.travelStore.getEndName=r)},null,8,["modelValue"])):U("",!0)]),_:1})]),_:1})),[[Q]]),V((m(),k(A,{clickable:""},{default:c(()=>[s(T,{avatar:"",class:"text-purple q-gutter-md"},{default:c(()=>[s(F,{name:"flight_takeoff"})]),_:1}),s(T,null,{default:c(()=>[s(j,{color:"primary",label:"目的地定位",onClick:e.getEndInfo})]),_:1})]),_:1})),[[Q]]),e.flagStart?(m(),k(e.TravelTable,{key:0,dialog:e.showStart,"onUpdate:dialog":t[8]||(t[8]=r=>e.showStart=r),tableData:e.tableData,"onUpdate:tableData":t[9]||(t[9]=r=>e.tableData=r),flag:e.flagStart,"onUpdate:flag":t[10]||(t[10]=r=>e.flagStart=r),need:"Start"},null,8,["dialog","tableData","flag"])):U("",!0),e.flagEnd?(m(),k(e.TravelTable,{key:1,dialog:e.showEnd,"onUpdate:dialog":t[11]||(t[11]=r=>e.showEnd=r),tableData:e.tableData,"onUpdate:tableData":t[12]||(t[12]=r=>e.tableData=r),flag:e.flagEnd,"onUpdate:flag":t[13]||(t[13]=r=>e.flagEnd=r),need:"End"},null,8,["dialog","tableData","flag"])):U("",!0)],64)}const Re=q(De,[["render",Me],["__scopeId","data-v-0da8d27b"],["__file","TravelChooseForm.vue"]]),Ue={__name:"OtherPlaceBtn",setup(a,{expose:t}){t();const o=E(),e=M();let u=e.nodes,n,r,g;const h={travelStore:o,otherStore:e,get nodes(){return u},set nodes(d){u=d},get length(){return n},set length(d){n=d},get id(){return r},set id(d){r=d},get nodeLayer(){return g},set nodeLayer(d){g=d},handleClick:()=>{let d=o.map,P={drawMarker:!0,drawCircleMarker:!1,drawPolyline:!1,drawPolygon:!1,drawRectangle:!1,drawCircle:!1,cutPolygon:!1,editMode:!1};d.pm.addControls(P),d.on("pm:create",function(v){let S=v.layer;v.shape,g=e.nodeLayer,g.hasLayer(S)||(g.addLayer(S),n=g.getLayers().length),S.bindPopup(`<p>中途站点${n}</p>`)})},get useOtherStore(){return M},get useTravelStore(){return E}};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}};function Be(a,t,o,e,u,n){return V((m(),k(A,{clickable:""},{default:c(()=>[s(T,{avatar:"",class:"text-purple q-gutter-md"},{default:c(()=>[s(F,{name:"mdi-printer-pos"})]),_:1}),s(T,null,{default:c(()=>[s(j,{color:"purple",icon:"mdi-map-marker-radius",label:"中途站点",onClick:e.handleClick})]),_:1})]),_:1})),[[Q]])}const Qe=q(Ue,[["render",Be],["__file","OtherPlaceBtn.vue"]]),Fe={__name:"ClearBtn",setup(a,{expose:t}){t();const o=M(),e=E(),n={otherStore:o,travelStore:e,handleClick:()=>{e.reset(),o.reset(e.map)},get useTravelStore(){return E},get useOtherStore(){return M}};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}};function Ae(a,t,o,e,u,n){return V((m(),k(A,{clickable:""},{default:c(()=>[s(T,{avatar:"",class:"text-purple q-gutter-md"},{default:c(()=>[s(F,{name:"mdi-restore"})]),_:1}),s(T,null,{default:c(()=>[s(j,{color:"green",icon:"mdi-restore",label:"重置",onClick:e.handleClick})]),_:1})]),_:1})),[[Q]])}const qe=q(Fe,[["render",Ae],["__file","ClearBtn.vue"]]),Ge={__name:"TravelForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(a,{expose:t}){t();const o=E(),e=Z(a,"modelValue"),u=x();let n=f(!1);O(()=>{o.startSure&&o.endSure&&(u.notify({message:"确定了起点和终点，可以选择其他中途站点",type:"positive",position:"top",timeout:1e3}),n.value=!0)});const r={travelStore:o,miniState:e,$q:u,get canOpen(){return n},set canOpen(g){n=g},ref:f,watchEffect:O,ShrinkDrawerBtn:Le,Search:Te,TravelChooseForm:Re,OtherPlaceBtn:Qe,ClearBtn:qe,get useTravelStore(){return E},get useQuasar(){return x}};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}};function je(a,t,o,e,u,n){return m(),k(ye,{class:"fit"},{default:c(()=>[s(e.TravelChooseForm,{"start-place-holder":"请输入起始点","end-place-holder":"请输入终点"}),e.canOpen?(m(),k(e.OtherPlaceBtn,{key:0})):U("",!0),s(e.Search),s(e.ClearBtn),s(e.ShrinkDrawerBtn,{modelValue:e.miniState,"onUpdate:modelValue":t[0]||(t[0]=r=>e.miniState=r)},null,8,["modelValue"])]),_:1})}const ze=q(Ge,[["render",je],["__file","TravelForm.vue"]]),He={__name:"Travel",setup(a,{expose:t}){t();const o=M(),e=E(),u=ge();let n;ie(()=>{n=ne(!1,!1,"zh");let d=new L.LayerGroup,P=new L.LayerGroup,v=new L.LayerGroup,S=new L.LayerGroup;d.addTo(n),S.addTo(n),v.addTo(n),P.addTo(n),o.nodeLayer=P,e.setMap(n),e.setMarkerLayer(d),e.setStartLayer(S),e.setEndLayer(v)});const r=f(!1),g=f(!0),h={otherStore:o,travelStore:e,settingStore:u,get map(){return n},set map(d){n=d},drawerRight:r,miniState:g,drawerClick:d=>{g.value&&(g.value=!1,d.stopPropagation())},ref:f,onMounted:ie,get GetMap(){return ne},TravelForm:ze,get useTravelStore(){return E},get useOtherStore(){return M},get useSettingStore(){return ge}};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}},Je=a=>(_e("data-v-70179147"),a=a(),ve(),a),We=Je(()=>$("div",{id:"map"},null,-1));function Ye(a,t,o,e,u,n){return m(),B(J,null,[We,s(fe,{side:"right",modelValue:e.drawerRight,"onUpdate:modelValue":t[1]||(t[1]=r=>e.drawerRight=r),"show-if-above":"",bordered:"",width:e.settingStore.rightDrawerWidth,breakpoint:500,class:"bg-blue-3",mini:!e.drawerRight||e.miniState,onClickCapture:e.drawerClick},{default:c(()=>[s(e.TravelForm,{modelValue:e.miniState,"onUpdate:modelValue":t[0]||(t[0]=r=>e.miniState=r)},null,8,["modelValue"])]),_:1},8,["modelValue","width","mini"])],64)}const ut=q(He,[["render",Ye],["__scopeId","data-v-70179147"],["__file","Travel.vue"]]);export{ut as default};
